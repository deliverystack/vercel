<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="dns-prefetch" href="https://jpw3.com">
    <link rel="preconnect" href="https://jpw3.com">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prune Bash History at Login</title>
    <link rel="stylesheet" href="/styles.css"> 
    <link rel="canonical" href="https://jpw3.com/articles/2025/December/bash-hist.html">

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FJ84G1V290"></script>
    <script>

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-FJ84G1V290');

  </script>
</head>
<body>

    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-XXXXXXX"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

    <div id="page-layout"> 
        <header>
            <h1>Prune Bash History at Login</h1>
            <nav class="breadcrumb"><a href="/">jpw3.com</a> › <a href="/articles/">Articles</a> › <a href="/articles/2025/">2025</a> › <a href="/articles/2025/December/">December</a> › <span class="breadcrumb-current">BASH History</span></nav>
        </header>

        <nav data-nosnippet>
            <ul><li class="current-branch"><details open><summary><a href="../../index.html">Articles</a></summary><ul><li><details><summary><a href="../../2013/index.html">2013</a></summary></details></li><li><details><summary><a href="../../2020/index.html">2020</a></summary></details></li><li><details><summary><a href="../../2021/index.html">2021</a></summary></details></li><li><details><summary><a href="../../2024/index.html">2024</a></summary></details></li><li class="current-branch"><details open><summary><a href="../index.html">2025</a></summary><ul><li class="current-branch"><details open><summary><a href="index.html">December</a></summary><ul><li><a class="nav-link" href="ai-cheatsheet.html" title="articles/2025/December/ai-cheatsheet.md">AI Cheat Sheet</a></li><li><a class="nav-link" href="avoid-types.html" title="articles/2025/December/avoid-types.md">Avoid Types</a></li><li class="current-file" title="articles/2025/December/bash-hist.md">BASH History</li><li><a class="nav-link" href="xclip.html" title="articles/2025/December/xclip.md">Capture to Clipboard</a></li><li><a class="nav-link" href="catholocism-origins.html" title="articles/2025/December/catholocism-origins.md">Catholicism Origin</a></li><li><a class="nav-link" href="static-site.html" title="articles/2025/December/static-site.md">Cheapest CMS</a></li><li><a class="nav-link" href="consumption-recommendations.html" title="articles/2025/December/consumption-recommendations.md">Consumption</a></li><li><a class="nav-link" href="my-ego.html" title="articles/2025/December/my-ego.md">Ego Struggle</a></li><li><a class="nav-link" href="evil-institutions.html" title="articles/2025/December/evil-institutions.md">Evil Is Institutional</a></li><li><a class="nav-link" href="fedora-shortcuts.html" title="articles/2025/December/fedora-shortcuts.md">Fedora Shortcuts</a></li><li><a class="nav-link" href="web-server.html" title="articles/2025/December/web-server.md">Fedora Web Server Startup</a></li><li><a class="nav-link" href="format-linkedin.html" title="articles/2025/December/format-linkedin.md">Format LinkedIn Content</a></li><li><a class="nav-link" href="gurdjieff-souls.html" title="articles/2025/December/gurdjieff-souls.md">Gurdjieff on Souls</a></li><li><a class="nav-link" href="markdown-cheatsheet.html" title="articles/2025/December/markdown-cheatsheet.md">Markdown Cheat Sheet</a></li><li><a class="nav-link" href="worst-mistakes.html" title="articles/2025/December/worst-mistakes.md">My Worst Mistakes</a></li><li><a class="nav-link" href="oscar-wilde.html" title="articles/2025/December/oscar-wilde.md">Oscar Wilde Quotes</a></li><li><a class="nav-link" href="relationship-person.html" title="articles/2025/December/relationship-person.md">Relationship/Person</a></li><li><a class="nav-link" href="fake-work.html" title="articles/2025/December/fake-work.md">Totalitarianism</a></li><li><a class="nav-link" href="tv-shows.html" title="articles/2025/December/tv-shows.md">TV Shows</a></li><li><a class="nav-link" href="us-border.html" title="articles/2025/December/us-border.md">US Border Prep</a></li><li><a class="nav-link" href="value-boredom.html" title="articles/2025/December/value-boredom.md">Value Boredom</a></li><li><a class="nav-link" href="vert-types.html" title="articles/2025/December/vert-types.md">Vert Types</a></li><li><a class="nav-link" href="wealth-power.html" title="articles/2025/December/wealth-power.md">Wealth and Power</a></li></ul></details></li><li><details><summary><a href="../November/index.html">November</a></summary></details></li><li><details><summary><a href="../October/index.html">October</a></summary></details></li><li><details><summary><a href="../May/index.html">May</a></summary></details></li><li><details><summary><a href="../February/index.html">February</a></summary></details></li></ul></details></li><li><details><summary><a href="../../psychology/index.html">Psychology</a></summary></details></li></ul></details></li><li><details ><summary><a href="../../../consciousness-stream/index.html">Mind Streams</a></summary><ul><li><details><summary><a href="../../../consciousness-stream/2025/index.html">2025</a></summary></details></li></ul></details></li><li><details ><summary><a href="../../../wip/index.html">WIP</a></summary><ul><li><a class="nav-link" href="../../../wip/ai-ldc.html" title="wip/ai-ldc.md">AI and LDCs</a></li><li><a class="nav-link" href="../../../wip/avoid-people.html" title="wip/avoid-people.md">Avoid People Who...</a></li><li><a class="nav-link" href="../../../wip/be-virtuous.html" title="wip/be-virtuous.md">Be Virtuous</a></li><li><a class="nav-link" href="../../../wip/dos-donts.html" title="wip/dos-donts.md">Do's and Don'ts</a></li><li><a class="nav-link" href="../../../wip/general-guidance.html" title="wip/general-guidance.md">General Guidance</a></li><li><a class="nav-link" href="../../../wip/green-flags.html" title="wip/green-flags.md">Green Flags</a></li><li><a class="nav-link" href="../../../wip/tech-actions.html" title="wip/tech-actions.md">Healthy Tech Actions</a></li><li><a class="nav-link" href="../../../wip/mixed.html" title="wip/mixed.md">mixed</a></li><li><a class="nav-link" href="../../../wip/us-christianity.html" title="wip/us-christianity.md">US Christianity</a></li><li><a class="nav-link" href="../../../wip/whats-wrong.html" title="wip/whats-wrong.md">USA, What's Wrong?</a></li><li><a class="nav-link" href="../../../wip/watchlist.html" title="wip/watchlist.md">watchlist</a></li></ul></details></li><li class="nav-separator"></li><li><a class="nav-link" href="../../../index.html" title="index.md">jpw3.com</a></li><li><a class="nav-link" href="../../../bibliography.html" title="bibliography.md">Bibliography</a></li><li><a class="nav-link" href="../../../command-lines.html" title="command-lines.md">Command Lines</a></li><li><a class="nav-link" href="../../../projects.html" title="projects.md">Github Projects</a></li><li><a class="nav-link" href="../../../topics.html" title="topics.md">Topics</a></li></ul>

            <form method="get" action="https://www.google.com/search">
              <input type="hidden" name="q" value="site:jpw3.com">
              &nbsp;&nbsp;<input type="text" name="q" placeholder="Search jpw3.com" style="width: 100px;">
              <input type="submit" value="Search">
            </form>
        </nav>
        
        <main>
            <h1>Prune Bash History at Login</h1>
<p>You can use code based on the following to prune your bash shell command history whenever you log in. This eliminates duplicate commands, which slightly improves performance and can make history easier to use.</p>
<p>I originally described this approach here: </p>
<ul>
<li><a href="https://wslguy.net/2021/04/09/clean-up-bash-history-at-shell-startup/" target="_blank" rel="noopener noreferrer">https://wslguy.net/2021/04/09/clean-up-bash-history-at-shell-startup/</a></li>
</ul>
<p>I had tried to modify that to merge history files from multiple machines:</p>
<ul>
<li><a href="https://github.com/deliverystack/wslbin/blob/main/bin/.histrc" target="_blank" rel="noopener noreferrer">https://github.com/deliverystack/wslbin/blob/main/bin/.histrc</a></li>
</ul>
<p>After moving from WSL (Windows Subsystem for Linux) to Fedora, something wasn't working correctly, and I no longer needed history from multiple machines, so I had gemeni make some suggestions. </p>
<p>You can add these commands directly to <code>~/.bashrc</code> or a script that it sources, or you can update one of those files to source this script, which you can keep as a separate script to source (not execute - <code>HISTFILE</code> might be different and <code>history -r</code> should run in the current shell).</p>
<ul>
<li><strong><code>histappend</code></strong>: Appended to rather than overwriting <code>HISTFILE</code> on shell exit.</li>
<li><strong><code>HISTCONTROL</code></strong>: Don't store sequential duplicates or those that start with a space.</li>
<li><strong><code>HISTSIZE</code></strong>: Maximum entries in memory.</li>
<li><strong><code>HISTFILESIZE</code></strong>: Maximum number of lines in HISTFILE.</li>
<li><strong><code>HISTFILE</code></strong>: Because it's not set yet otherwise.</li>
</ul>
<p>This is how it works:</p>
<ul>
<li><code>nl</code>: Prepend line number for sorting back to original order.</li>
<li>First <code>sort</code>: Sort in reverse (newest commands first).</li>
<li>First <code>sed</code>: Trim whitespace for matching duplicates.</li>
<li>Second <code>sort</code>: Deduplicate commands.</li>
<li>Third <code>sort</code>: Re sort to chronological order (most recent last).</li>
<li><code>cut</code>: Remove line numbers added by <code>nl</code>.</li>
<li>Second <code>sed</code>: Trim whitespace, removing any with less than 8 characters.</li>
</ul>
<p>The <code>hb</code> uses <code>bat</code> to view the history with some formatting.</p>
<ul>
<li><a href="https://github.com/sharkdp/bat" target="_blank" rel="noopener noreferrer">https://github.com/sharkdp/bat</a></li>
</ul>
<pre><code class="language-sh">shopt -s histappend

export HISTCONTROL=ignoreboth
export HISTSIZE=10000
export HISTFILESIZE=10000

HISTFILE=&quot;$HOME/.bash_history&quot;

if [[ -z &quot;$HISTFILE&quot; || ! -f &quot;$HISTFILE&quot; ]]; then
    echo &quot;Error: HISTFILE is not defined or does not exist. Cannot clean history.&quot; &gt;&amp;2
    return 1
fi

temphist=$(mktemp)

nl &quot;$HISTFILE&quot; \
    | sort -f -b -k2 -r \
    | sed 's/[[:blank:]]*$//' \
    | sort -f -b -k2 -r -u \
    | sort -n \
    | cut -c8- \
    | sed 's/^[[:space:]]*//; s/[[:space:]]*$//; /\([^[:space:]]\{1\}.*\)\{8\}/!d' &gt; &quot;$temphist&quot;
mv &quot;$temphist&quot; &quot;$HISTFILE&quot;
history -r
alias hb='history | tac | bat -l sh'
</code></pre>

        </main>
        
        <footer>
            <p>Source: <code>/articles/2025/December/bash-hist.md</code> | Created : 2025-12-20 | Last modified: 2025-12-20</p>
        </footer>
    </div>
</body>
</html>